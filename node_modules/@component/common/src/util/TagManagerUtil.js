{
  const _ = require('underscore');
  const log = require('./Logger');
  const validEventTypes = ['view', 'link'];

  function isAllOK(eventType, data) {
    if (_.isUndefined(eventType) || _.isUndefined(data)) {
      log.error('Tag Manager Exception : eventType and/or data missing!');
      return false;
    }

    if (_.indexOf(validEventTypes, eventType) === -1) {
      log.error('Tag Manager Exception : invalid eventType!');
      return false;
    }

    if (_.isUndefined(window.utag)) {
      log.error('Tag Manager Exception: window.utag missing!');
      return false;
    }

    if (_.isUndefined(window.utag[eventType])) {
      log.error(`Tag Manager Exception: utag.${eventType} missing!`);
      return false;
    }

    return true;
  }

  function isAllOKToUpdateUtagData() {
    if (_.isUndefined(window.utag.data)) {
      log.error('Tag Manager Exception: window.utag.data missing!');
      return false;
    }

    return true;
  }

  module.exports = {
    fireTag(eventType, data) {
      if (isAllOK(eventType, data)) {
        window.utag[eventType](data);
      }
    },
    updateUtagDataFireTag(eventType, data) {
      if (isAllOK(eventType, data) && isAllOKToUpdateUtagData()) {
        delete window.utag.data.adobe_page_name;
        window.utag[eventType](_.extend(window.utag.data, data));
      }
    },
  };
}
