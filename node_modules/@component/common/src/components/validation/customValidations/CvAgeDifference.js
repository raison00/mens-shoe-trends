// #MODULE - CvAgeDifference
// > Author: Ramesh Polishetti
// >
// > Create Date: 2014-09-04
// >
// ##DESCRIPTION: Custom age difference form validation method to inject into validation.js.
// Checks whether with the given date of birth, reached minimum age.

{
  const Validation = require('../Validation');
  const DateUtil = require('../../../util/DateUtil');
  // ###Method - checkAge(value, limitYears)
  // Public method to check the age with given date of birth is equal or greater than the limit years.
  //
  // > parameters
  // >
  // + *value* : *Valid Date string* |* milliseconds *
  // + *limitYears* : *Years to compare*
  //
  //
  // > returns
  // >
  // + Boolean value of True if the age with given date of birth is equal or greater than the limit years
  // + False if the age with given date of birth is less than the limit years

  const checkAge = function (value, limitYears) {
    const curDate = new Date();
    const birthDate = new Date(value);
    let currentYear = curDate.getFullYear();
    let i;
    let totalDays = 0;

    /* function isCutOffMonth( month, year ) {
            if ( DateUtil.checkLeapYear( year ) && month > 2 ) {
                return true;
            }
            return false;
        } */

    for (i = 0; i < limitYears; i++) {
      const upMonth = DateUtil.checkLeapYear(currentYear);
      totalDays += upMonth ? 366 : 365;
      currentYear -= 1;
    }
    const cutOfTime = totalDays * 86400000;
    const actualAgeTime = curDate.getTime() - birthDate.getTime();

    return Validation.isEqual(actualAgeTime, cutOfTime) || Validation.isGreaterThan(actualAgeTime, cutOfTime);
  };
  Validation.addMethod('ageDifference', checkAge);
  module.exports = checkAge;
}
