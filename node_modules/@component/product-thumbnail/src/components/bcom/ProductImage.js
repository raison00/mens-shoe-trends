// #MODULE - ProductImage
// > Author: Michael Moir
// > Migrate: Balasubramanian Karthikesan
// > Create Date: Dec 29, 2016
//
// ##DESCRIPTION:
// handle bloomingdales showing alt img on hover.

import _ from 'underscore';
import $ from 'jquery';
import ProductImage from '../ProductImage';

// ###Method - attachAdditionalImages
// This method will attach the additional images to the given image for showing alt image when hovering on thumbnail.
// > parameters
// >
// + jQueryImage - The image tag as selected via jQuery.  This is the image that will get the treatment.
//
// > returns
// >
// + Nothing.
function attachAdditionalImages(jqueryContainer) {
  const showHide = () => {
    $(jqueryContainer).mouseover((event) => {
      const container = $(event.currentTarget);
      const altImage = $(event.currentTarget).attr('data-altimage');

      if (container && altImage && altImage !== '') {
        container.css('left', `${-(container.width() / 2)}px`);
      }
    });
    $(jqueryContainer).mouseout((event) => {
      const container = $(event.currentTarget);
      container.css('left', '0px');
    });
  };

  if (
    $(jqueryContainer).hasClass('altImage') ||
    $(jqueryContainer)
      .closest('.productThumbnail')
      .find('.colorSwatch div[data-altimage="true"]').length
  ) {
    if (!this.meta || !this.meta.properties || !this.meta.properties.bcomCanvasResponsiveEnabled) {
      showHide();
    }
  }
}

export default _.extend(ProductImage, {
  attachAdditionalImagesByCollection(jqueryImageArray) {
    const that = this;
    $(jqueryImageArray).each((idx, obj) => {
      that.attachAdditionalImages(obj);
    });
  },
  attachAdditionalImages(jqueryContainer) {
    attachAdditionalImages.call(this, jqueryContainer);
  },
});
