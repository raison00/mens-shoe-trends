module.exports = function (imageData, minWidth) {
  const _ = require('underscore');

  const imageHost = 'https://slimages.macysassets.com/is/image/MCY';

  const clearGif = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';
  if (!_.isUndefined(imageData) && imageData !== null) {
    let urlTemplate = imageData.urlTemplate;
    let filePath = !_.isUndefined(imageData.primaryImage) ? imageData.primaryImage.filePath : imageData.filePath;
    const width = !_.isUndefined(imageData.primaryImage) && imageData.primaryImage.width ? imageData.primaryImage.width : minWidth || 224;
    const quality = '90,0';
    let imgUrl = '';

    if (_.isUndefined(urlTemplate)) {
      urlTemplate = `${imageHost}/products`;
    }

    if (_.isUndefined(urlTemplate) || urlTemplate === '') {
      return clearGif;
    }

    if (_.isUndefined(filePath)) {
      return clearGif;
    }

    if (!/\.(tif)$/i.test(filePath)) {
      filePath = `${filePath}.tif`;
    }

    if (urlTemplate.indexOf('[IMAGEFILEPATH]') > 0) {
      imgUrl = urlTemplate
        .replace(/\[IMAGEFILEPATH\]/gi, filePath)
        .replace(/\[WIDTH\]/gi, width)
        .replace(/\[QUALITY\]/gi, quality);
    } else {
      imgUrl += `${urlTemplate}/${filePath}`;
      imgUrl += `?bgc=255,255,255&wid=${width}`;
      imgUrl += '&qlt=90,0&layer=comp&op_sharpen=0&resMode=bicub&op_usm=0.7,1.0,0.5,0&fmt=jpeg';
    }
    return imgUrl;
  }
  return clearGif;
};
