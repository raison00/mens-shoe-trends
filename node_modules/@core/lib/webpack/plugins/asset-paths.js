/**
 * AssetPathsPlugin is a webpack plugin that saves a file called "assets.json" to the output path
 * during webpack compilation. Contains an object keyed by entry point, with sets of assets
 * grouped by file extension. Assets have the full public path populated.
 */

const extractAssets = require('../lib/extract-assets');

function AssetPathsPlugin() {}

AssetPathsPlugin.prototype.apply = function apply(compiler) {
  compiler.plugin('emit', (compilation, done) => {
    let result;

    compilation.assets['assets.json'] = { // eslint-disable-line no-param-reassign
      size: function getSize() {
        return (result && result.length) || 0;
      },
      source: function getSource() {
        result = JSON.stringify(extractAssets(compilation.getStats().toJson(), false));
        return result;
      },
    };
    done();
  });
};

module.exports = AssetPathsPlugin;
