/* eslint-disable no-param-reassign */
/**
 * Given an object of stats generated by the webpack compiler,
 * Extract the assets that were generated.
 *
 * Return a nice friendly object in the following format:
 *
 * {
 *  "entryA": {
 *    "js": [],
 *    "css": []
 *  },
 *  "entryB": {
 *    "js": [],
 *    "css": []
 *  }
 * }
 */

const _ = require('lodash');
const path = require('path');

module.exports = (stats = {}) => {
  const extname = asset => path.extname(asset).substring(1);
  const formatter = asset => path.join(stats.publicPath, asset);

  return _.transform(stats.entrypoints, (result, value, entryPoint) => {
    result[entryPoint] = _.transform(value.assets, (entry, asset) => {
      const ext = extname(asset);
      (entry[ext] || (entry[ext] = [])).push(formatter(asset));
    }, {});
  }, {});
};
