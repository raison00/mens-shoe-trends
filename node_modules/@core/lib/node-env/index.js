const _ = require('lodash');
const dotenv = require('dotenv');

module.exports = {
  /**
   * Sets the node env
   *
   * If a value is passed in, attempts to resolve to a known environment.
   * Else, attempts to resolve to process.env.NODE_ENV.
   * If process.env.NODE_ENV is not set, defaults to production to prevent accidental dev leaks.
   */
  set: (env) => {
    let nodeEnv = env;

    if (env === 'dev') {
      nodeEnv = 'development';
    } else if (env === 'prod') {
      nodeEnv = 'production';
    }

    if (nodeEnv && !_.includes(['development', 'production'], nodeEnv)) {
      return false;
    }

    process.env.NODE_ENV = nodeEnv || process.env.NODE_ENV || 'production';
    return true;
  },

  /**
   * Loads env config from file
   */
  loadConfig: async configFile => dotenv.config({ path: configFile }).parsed || {},
};
