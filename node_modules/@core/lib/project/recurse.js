const _ = require('lodash');
const resolve = require('./resolve');

const recurse = (cb, project = {}) => {
  const pkgPath = project.root ? `${project.root}/package.json` : 'package.json';

  // eslint-disable-next-line import/no-dynamic-require
  const { dependencies } = require(resolve(pkgPath));

  if (dependencies) {
    Object.keys(dependencies).forEach((key) => {
      const [scope, name] = key.split('/');
      const root = `node_modules/${scope}/${name}`;

      // @TODO remove beta scope
      if (_.includes(['@beta', '@page', '@feature', '@component'], scope)) {
        cb({ root, scope, name });
        recurse(cb, { root, scope, name });
      }
    });
  }
};

module.exports = recurse;
