#!/bin/bash

# MCOM is set as default brand if brand is not set
# DEFAULTBRAND="mcom"

# Colors for echo statements
RED='\033[0;31m'
NC='\033[0m'
GREEN='\033[0;32m'
CHECK='\xE2\x9C\x94'

# Check for brand
#If no brand name was passed or if the brand passed is not valid (mcom/bcom), use mcom as default brand to continue
#If the input is capitalized, then turn to lowercase and continue
#If input is valid, continue
if [[ -z $1 ]] || [[ $(echo "$1" | tr [:upper:] [:lower:]) != "mcom" && $(echo "$1" | tr [:upper:] [:lower:]) != "bcom" ]]
then
    echo -e "${RED}NO BRAND WAS SPECIFIED.${NC} MCOM WILL BE RUN. \n"
    BRAND="mcom"
elif [[ $1 =~ [A-Z] ]]
then
    BRAND="$(echo $1 | tr '[A-Z]' '[a-z]')" 
else
    BRAND=$1 #Use given brand 
fi

#if the encodedIcons directory does not exist, then run base64-icon generator to create the directory and the sprites
if [ ! -d "./src/scss/${BRAND}/encodedIcons/" ]
then
    echo "Running base64-icons script to create ${BRAND} sprites."
    npm run base64-icons ${BRAND}
fi

#Import files to corresponding directory
ls ./src/scss/${BRAND}/encodedIcons/ | sed 's/^/@import "encodedIcons\//' | sed 's/\.scss/";/' > ./src/scss/${BRAND}/${BRAND}-sprites.scss
echo "Sprite generated at $(date)" | sed 's/^/\/\//' >> ./src/scss/${BRAND}/${BRAND}-sprites.scss

echo -e "${GREEN} ${CHECK} Icons from ./src/scss/encodedIcons have been imported to ./src/scss/${BRAND}/${BRAND}-sprites.scss${NC}\n"

################################################
# ${BRAND} stores brand name (mcom/bcom)

# line 2 prints all of the icons in 'encodedIcons' folder, then using sed stream editor, prepends '@import "encodedIcons/' to the beginning of each icon file, and substitutes all '.scss/' file extention with just a ';' semicolon.  It then appends each line into './src/scss/bcom-sprites.scss' file.

# line 3 prints time generated at end of file
################################################
