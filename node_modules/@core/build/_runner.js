#!/usr/bin/env node

const webpack = require('webpack');

const buildEnv = process.env.BUILD_ENV || 'client';

if (buildEnv !== 'client' && buildEnv !== 'server') {
  throw new Error(`Invalid build environment: ${buildEnv}. Must be "client" or "server".`);
}

const config = require(`./config/webpack.${buildEnv}.js`); // eslint-disable-line import/no-dynamic-require

webpack(config, (err, stats) => {
  if (err) {
    throw err;
  } else if (stats.hasErrors()) {
    throw new Error(stats.toJson().errors);
  } else {
    // eslint-disable-next-line no-console
    console.log(stats.toString({ colors: true, chunks: true }));
  }
});
