const path = require('path');
const { fork } = require('@core/lib/child-process');

module.exports = (target = 'client', options = {}) => {
  const { entryPoint, nodeEnv } = options;
  const env = { NODE_ENV: nodeEnv, BUILD_ENV: target };

  // (if) check necessary - else, process.env.ENTRY_POINT might be the string "undefined"
  if (entryPoint) {
    env.ENTRY_POINT = entryPoint;
  }

  return fork(path.resolve(__dirname, '_runner.js'), ['--color'], {
    env: { ...process.env, ...env },
  });
};
